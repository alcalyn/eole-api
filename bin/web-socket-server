<?php

require_once __DIR__.'/../vendor/autoload.php';

use Ratchet\Server\IoServer;
use Ratchet\Http\HttpServer;
use Ratchet\WebSocket\WsServer;
use Ratchet\Wamp\ServerProtocol;
use Eole\Silex\Application as SilexApplication;
use Eole\WebSocket\Application as WebSocketApplication;

echo 'Initialization...'.PHP_EOL;

// Create Eole silex application
$silexApp = new SilexApplication(array(
    'project.root' => dirname(__DIR__),
    'env' => 'dev',
    'debug' => true,
));

// Create Eole websocket application
$wsApp = new WebSocketApplication($silexApp);

$host = $silexApp['environment']['websocket']['server']['host'];
$port = $silexApp['environment']['websocket']['server']['port'];

// Create websocket server
$server = IoServer::factory(new HttpServer(new WsServer(new ServerProtocol($wsApp))), $port, $host);

echo "Running websocket server on $host:$port".PHP_EOL;

$server->run();
