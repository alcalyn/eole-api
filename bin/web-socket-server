<?php

require_once __DIR__.'/../vendor/autoload.php';

use Ratchet\Server\IoServer;
use Ratchet\Http\HttpServer;
use Ratchet\WebSocket\WsServer;
use Ratchet\Wamp\ServerProtocol;
use Eole\Silex\Application as SilexApplication;
use Eole\WebSocket\Application as WebSocketApplication;

echo 'Initialization...'.PHP_EOL;

$silexApp = new SilexApplication(array(
    'project.root' => dirname(__DIR__),
    'env' => 'dev',
    'debug' => true,
));

$wsApp = new WebSocketApplication();

$wsApp->addApplicationTopic('eole/core/chat', new Eole\WebSocket\Chat('eole/core/chat'));

$address = '0.0.0.0';
$port = 8080;

$server = IoServer::factory(new HttpServer(new WsServer(new ServerProtocol($wsApp))), $port, $address);

echo 'Running websocket server...'.PHP_EOL;

$server->run();
